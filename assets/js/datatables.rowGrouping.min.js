!function(e){"use strict";e.fn.rowGrouping=function(r){function n(){}function o(){}function a(){}function u(e){var r=["January","February","March","April","May","June","July","August","September","October","November","December"];return r[e-1]}var t={iGroupingColumnIndex:0,sGroupingColumnSortDirection:"",iGroupingOrderByColumnIndex:-1,sGroupingClass:"group",sGroupItemClass:"group-item",bHideGroupingColumn:!0,bHideGroupingOrderByColumn:!0,sGroupBy:"name",sGroupLabelPrefix:"",fnGroupLabelFormat:function(e){return e},bExpandableGrouping:!1,bExpandSingleGroup:!1,iExpandGroupOffset:100,asExpandedGroups:null,sDateFormat:"dd/MM/yyyy",sEmptyGroupLabel:"-",bSetGroupingClassOnTR:!1,iGroupingColumnIndex2:-1,sGroupingColumnSortDirection2:"",iGroupingOrderByColumnIndex2:-1,sGroupingClass2:"subgroup",sGroupItemClass2:"subgroup-item",bHideGroupingColumn2:!0,bHideGroupingOrderByColumn2:!0,sGroupBy2:"name",sGroupLabelPrefix2:"",fnGroupLabelFormat2:function(e){return e},bExpandableGrouping2:!1,fnOnGrouped:n,fnOnGroupCreated:o,fnOnGroupCompleted:a,oHideEffect:null,oShowEffect:null,bUseFilteringForGrouping:!1};return this.each(function(n,o){function a(r,n,o){var a=document.createElement("tr"),u=document.createElement("td");a.id="group-id-"+y.attr("id")+"_"+r;var t={id:a.id,key:r,text:n,level:0,groupItemClass:".group-item-"+r,dataGroup:r,aoSubgroups:new Array};return D.bSetGroupingClassOnTR?a.className=D.sGroupingClass+" "+r:u.className=D.sGroupingClass+" "+r,u.colSpan=o,u.innerHTML=D.sGroupLabelPrefix+D.fnGroupLabelFormat(""==n?D.sEmptyGroupLabel:n,t),D.bExpandableGrouping&&(s(r)?(u.className+=" collapsed-group",t.state="collapsed"):(u.className+=" expanded-group",t.state="expanded"),u.className+=" group-item-expander",e(u).attr("data-group",t.dataGroup),e(u).attr("data-group-level",t.level),e(u).click(x)),a.appendChild(u),E[r]=t,t.nGroup=a,D.fnOnGroupCreated(t,r,1),t}function i(r,n,o,a){var u=document.createElement("tr");u.id=a.id+"_"+r;var t=document.createElement("td"),i=a.dataGroup+"_"+r,p={id:u.id,key:r,text:n,level:a.level+1,groupItemClass:".group-item-"+i,dataGroup:i,aoSubgroups:new Array};return D.bSetGroupingClassOnTR?u.className=D.sGroupingClass2+" "+r:t.className=D.sGroupingClass2+" "+r,t.colSpan=o,t.innerHTML=D.sGroupLabelPrefix2+D.fnGroupLabelFormat2(""==n?D.sEmptyGroupLabel:n,p),D.bExpandableGrouping&&(u.className+=" group-item-"+a.dataGroup),D.bExpandableGrouping&&D.bExpandableGrouping2&&(s(p.dataGroup)?(t.className+=" collapsed-group",p.state="collapsed"):(t.className+=" expanded-group",p.state="expanded"),t.className+=" group-item-expander",e(t).attr("data-group",p.dataGroup),e(t).attr("data-group-level",p.level),e(t).click(x)),u.appendChild(t),a.aoSubgroups[p.dataGroup]=p,E[p.dataGroup]=p,p.nGroup=u,D.fnOnGroupCreated(p,r,2),p}function s(r){return null!=E[r]?"collapsed"==E[r].state:r.indexOf("_")>-1?void 0:!S||null!=h&&0!=h.length?-1==e.inArray(r,h):!1}function p(e){return e.length<v+O?e:e.substr(v,O)}function d(e){return e}function l(e){return e.substr(0,1)}function g(e){return p(e)}function G(e){return e.substr(v,O)+" "+u(e.substr(I,w))}function f(e){return""===e?"-":e.toLowerCase().replace(/[^a-zA-Z0-9\u0080-\uFFFF]+/g,"-")}function m(e,r,n){if(e.nTable.id!==y[0].id)return!0;var o=r[D.iGroupingColumnIndex];return"undefined"==typeof o&&(o=r[e.aoColumns[D.iGroupingColumnIndex].mDataProp]),s(f(o))?(y.fnIsOpen(y.fnGetNodes(n))&&(null!=D.fnOnRowClosed&&D.fnOnRowClosed(this),y.fnClose(y.fnGetNodes(n))),!1):!0}function C(r){return E[r].state="expanded",e("td[data-group^='"+r+"']").removeClass("collapsed-group"),e("td[data-group^='"+r+"']").addClass("expanded-group"),D.bUseFilteringForGrouping?void y.fnDraw():(-1==jQuery.inArray(r,h)&&h.push(r),void(null!=D.oHideEffect?e(".group-item-"+r,y)[D.oShowEffect.method](D.oShowEffect.duration,D.oShowEffect.easing,function(){}):e(".group-item-"+r,y).show()))}function c(r){return E[r].state="collapsed",e("td[data-group^='"+r+"']").removeClass("expanded-group"),e("td[data-group^='"+r+"']").addClass("collapsed-group"),D.bUseFilteringForGrouping?void y.fnDraw():(e(".group-item-"+r).each(function(){y.fnIsOpen(this)&&(null!=D.fnOnRowClosed&&D.fnOnRowClosed(this),y.fnClose(this))}),void(null!=D.oHideEffect?e(".group-item-"+r,y)[D.oHideEffect.method](D.oHideEffect.duration,D.oHideEffect.easing,function(){}):e(".group-item-"+r,y).hide()))}function x(r){var n=e(this).attr("data-group"),o=(e(this).attr("data-group-level"),!s(n));if(D.bExpandSingleGroup){if(!o){var a=e("td.expanded-group").attr("data-group");if(c(a),C(n),-1!=D.iExpandGroupOffset){var u=e("#group-id-"+y.attr("id")+"_"+n).offset().top-D.iExpandGroupOffset;window.scroll(0,u)}else{var u=y.offset().top;window.scroll(0,u)}}}else o?c(n):C(n);r.preventDefault()}function b(r){y.fnSettings().oFeatures.bServerSide&&(S=!0);var n=!1;if(-1!=D.iGroupingColumnIndex2&&(n=!0),0!=r.aiDisplayMaster.length){for(var o=e("tbody tr",y),u=0,t=0;t<r.aoColumns.length;t++)r.aoColumns[t].bVisible&&(u+=1);var p=null,d=null;if(r.aiDisplay.length>0)for(var l=0;l<o.length;l++){var g=r._iDisplayStart+l;y.fnSettings().oFeatures.bServerSide&&(g=l);var G="",m=null,C="",c=null;G=this.fnGetData(o[l],D.iGroupingColumnIndex);var m=G;if("year"!=D.sGroupBy&&(m=F(G)),n&&(C=r.aoData[r.aiDisplay[g]]._aData[D.iGroupingColumnIndex2],void 0==C&&(C=r.aoData[r.aiDisplay[g]]._aData[r.aoColumns[D.iGroupingColumnIndex2].mDataProp]),"year"!=D.sGroupBy2&&(c=F(C))),null==p||f(m)!=f(p)){var x=f(m);null!=p&&D.fnOnGroupCompleted(E[f(p)]),D.bAddAllGroupsAsExpanded&&-1==jQuery.inArray(x,h)&&h.push(x);var b=a(x,m,u),v=b.nGroup;null!=o[l].parentNode?o[l].parentNode.insertBefore(v,o[l]):e(o[l]).before(v),p=m,d=null}if(e(o[l]).attr("data-group",E[x].dataGroup),e(o[l]).addClass(D.sGroupItemClass),e(o[l]).addClass("group-item-"+x),D.bExpandableGrouping&&s(x)&&!D.bUseFilteringForGrouping&&e(o[l]).hide(),n){if(null==d||f(c)!=f(d)){var O=f(m)+"-"+f(c),I=i(O,c,u,E[x]),w=I.nGroup;o[l].parentNode.insertBefore(w,o[l]),d=c}e(o[l]).attr("data-group",I.dataGroup).addClass(D.sGroupItemClass2).addClass("group-item-"+I.dataGroup)}}null!=p&&D.fnOnGroupCompleted(E[f(p)]),D.fnOnGrouped(E),S=!1}}var y=e(o).dataTable(),E=new Array;e(this).dataTableExt.aoGroups=E;var v=6,O=4,h=new Array,S=!0,D=e.extend(t,r);-1==D.iGroupingOrderByColumnIndex?(D.bCustomColumnOrdering=!1,D.iGroupingOrderByColumnIndex=D.iGroupingColumnIndex):D.bCustomColumnOrdering=!0,""==D.sGroupingColumnSortDirection&&(D.sGroupingColumnSortDirection="year"==D.sGroupBy?"desc":"asc"),-1==D.iGroupingOrderByColumnIndex2?(D.bCustomColumnOrdering2=!1,D.iGroupingOrderByColumnIndex2=D.iGroupingColumnIndex2):D.bCustomColumnOrdering2=!0,""==D.sGroupingColumnSortDirection2&&(D.sGroupingColumnSortDirection2="year"==D.sGroupBy2?"desc":"asc"),v=D.sDateFormat.toLowerCase().indexOf("yy"),O=D.sDateFormat.toLowerCase().lastIndexOf("y")-D.sDateFormat.toLowerCase().indexOf("y")+1;var I=D.sDateFormat.toLowerCase().indexOf("mm"),w=D.sDateFormat.toLowerCase().lastIndexOf("m")-D.sDateFormat.toLowerCase().indexOf("m")+1,F=d;switch(D.sGroupBy){case"letter":F=l;break;case"year":F=g;break;case"month":F=G;break;default:F=d}if(null!=D.asExpandedGroups){if("NONE"==D.asExpandedGroups)D.asExpandedGroups=[],h=D.asExpandedGroups,S=!1;else if("ALL"==D.asExpandedGroups)D.bAddAllGroupsAsExpanded=!0;else if(D.asExpandedGroups.constructor==String){var A=D.asExpandedGroups;D.asExpandedGroups=new Array,D.asExpandedGroups.push(f(A)),h=D.asExpandedGroups,S=!1}else if(D.asExpandedGroups.constructor==Array){for(var B=0;B<D.asExpandedGroups.length&&(h.push(f(D.asExpandedGroups[B])),!D.bExpandSingleGroup);B++);S=!1}}else D.asExpandedGroups=new Array,D.bAddAllGroupsAsExpanded=!0;if(D.bExpandSingleGroup){var L=e("tbody tr",y),N=y.fnGetData(L[0],D.iGroupingColumnIndex),H=N;"year"!=D.sGroupBy&&(H=F(N));var T=f(H);D.asExpandedGroups=new Array,D.asExpandedGroups.push(T)}y.fnSetColumnVis(D.iGroupingColumnIndex,!D.bHideGroupingColumn),D.bCustomColumnOrdering&&y.fnSetColumnVis(D.iGroupingOrderByColumnIndex,!D.bHideGroupingOrderByColumn),-1!=D.iGroupingColumnIndex2&&y.fnSetColumnVis(D.iGroupingColumnIndex2,!D.bHideGroupingColumn2),D.bCustomColumnOrdering2&&y.fnSetColumnVis(D.iGroupingOrderByColumnIndex2,!D.bHideGroupingOrderByColumn2),y.fnSettings().aoDrawCallback.push({fn:b,sName:"fnRowGrouping"});var k=new Array;switch(k.push([D.iGroupingOrderByColumnIndex,D.sGroupingColumnSortDirection]),-1!=D.iGroupingColumnIndex2&&k.push([D.iGroupingOrderByColumnIndex2,D.sGroupingColumnSortDirection2]),y.fnSettings().aaSortingFixed=k,D.sGroupBy){case"name":break;case"letter":y.fnSettings().aoColumns[D.iGroupingOrderByColumnIndex].sSortDataType="rg-letter",e.fn.dataTableExt.afnSortData["rg-letter"]=function(r,n){var o=[];return e("td:eq("+n+")",r.oApi._fnGetTrNodes(r)).each(function(){o.push(l(this.innerHTML))}),o};break;case"year":y.fnSettings().aoColumns[D.iGroupingOrderByColumnIndex].sSortDataType="rg-date",e.fn.dataTableExt.afnSortData["rg-date"]=function(e,r){var n=[],o=e.oApi._fnGetTrNodes(e);for(B=0;B<o.length;B++)n.push(p(y.fnGetData(o[B],r)));return n}}D.bUseFilteringForGrouping&&e.fn.dataTableExt.afnFiltering.push(m),y.fnDraw()})}}(jQuery);